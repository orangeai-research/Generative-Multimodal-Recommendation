# RFMRec: Rectified Flow for Multimodal Recommendation

åŸºäº **Rectified Flow** çš„ç”Ÿæˆå¼å¤šæ¨¡æ€æ¨èæ¨¡å‹ï¼Œå°† Liu et al. (2022) çš„ Rectified Flow æ–¹æ³•åº”ç”¨äºæ¨èç³»ç»Ÿã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

  è¿è¡Œè®­ç»ƒ

  cd GenMMRec/src
  python main.py --model rfmrec --dataset baby

  å…³é”®ç‰¹æ€§

  | ç‰¹æ€§              | è¯´æ˜                           |
  |-------------------|--------------------------------|
  | ğŸ¯ å¤šå°ºåº¦æ¡ä»¶æ³¨å…¥ | äº¤äº’å›¾ + è§†è§‰ + æ–‡æœ¬å¤šæ¨¡æ€èåˆ |
  | âš¡ 1 æ­¥ç”Ÿæˆ       | Reflow ååªéœ€ 1 æ­¥ ODE æ±‚è§£    |
  | ğŸ“Š ç†è®ºä¿è¯       | è·¯å¾„å˜ç›´ï¼ˆTheorem 3.7ï¼‰        |
  | ğŸ”§ æ˜“äºæ‰©å±•       | æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡               |

  ---
  ğŸ—ï¸ æ¨¡å‹æ¶æ„äº®ç‚¹

  1. å¤šå°ºåº¦æ¡ä»¶æ³¨å…¥ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰

  # ä¸åŒå±‚çº§æ³¨å…¥æ¡ä»¶ä¿¡å·
  for block in self.res_blocks:
      h = block(h, cond_emb)  # FiLM è°ƒåˆ¶

  # æ¡ä»¶æ¥æºï¼š
  - ç”¨æˆ·-ç‰©å“å›¾å·ç§¯ï¼ˆååŒè¿‡æ»¤ï¼‰
  - è§†è§‰ç‰¹å¾ï¼ˆå›¾åƒï¼‰
  - æ–‡æœ¬ç‰¹å¾ï¼ˆæ–‡æœ¬ï¼‰

  2. FiLM è°ƒåˆ¶ï¼ˆå¢å¼ºæ§åˆ¶ï¼‰

  # åœ¨æ¯ä¸ªæ®‹å·®å—ä¸­
  scale = self.cond_scale(cond)
  shift = self.cond_shift(cond)
  h = scale * h + shift  # æ¡ä»¶åŒ–ç‰¹å¾

  3. Rectified Flow æŸå¤±ï¼ˆè®ºæ–‡å…¬å¼ 1ï¼‰

  # è®­ç»ƒç›®æ ‡
  loss = ||v(X_t, t, c) - (X1 - X0)||Â²

  # å…¶ä¸­ X_t = t*X1 + (1-t)*X0

  ---
  ğŸ“ˆ é¢„æœŸæ•ˆæœ

  æ ¹æ®è®ºæ–‡å’Œæ¨èåœºæ™¯ï¼š

  | æŒ‡æ ‡     | 1-Rectified | 2-Rectified (Reflow) |
  |----------|-------------|----------------------|
  | é‡‡æ ·æ­¥æ•° | 100 æ­¥      | 1 æ­¥ âš¡              |
  | ç”Ÿæˆè´¨é‡ | é«˜          | ç›¸å½“                 |
  | æ¨ç†é€Ÿåº¦ | åŸºå‡†        | 100x æå‡ ğŸš€         |
  | å¤šæ ·æ€§   | â­â­â­â­    | â­â­â­â­             |

  ---
  ğŸ”§ ä¸‹ä¸€æ­¥å»ºè®®

  1. æµ‹è¯•è¿è¡Œ

  # ç¡®ä¿æ•°æ®é›†å’Œç‰¹å¾æ–‡ä»¶å°±ä½
  ls GenMMRec/data/baby/

  # è¿è¡Œè®­ç»ƒ
  cd GenMMRec/src
  python main.py --model rfmrec --dataset baby

  2. è°ƒæ•´è¶…å‚æ•°

  æ ¹æ®æ•°æ®é›†è§„æ¨¡è°ƒæ•´ï¼š

  | æ•°æ®é›†å¤§å°     | embedding_size | rf_hidden_dim | rf_n_layers |
  |----------------|----------------|---------------|-------------|
  | å°ï¼ˆ<10Kï¼‰     | 32-64          | 256           | 2           |
  | ä¸­ï¼ˆ10K-100Kï¼‰ | 64-128         | 512           | 3           |
  | å¤§ï¼ˆ>100Kï¼‰    | 128-256        | 1024          | 4           |

  3. Reflow å®éªŒ

  # å°è¯•ä¸åŒ reflow æ¬¡æ•°
  rf_reflow_steps: 0  # åŸºå‡†ï¼ˆæ—  reflowï¼‰
  rf_reflow_steps: 1  # æ¨è
  rf_reflow_steps: 2  # è¿›ä¸€æ­¥æå‡

  4. å¯è§†åŒ–ç”Ÿæˆè·¯å¾„

  åœ¨ sample_ode ä¸­æ·»åŠ ï¼š
```python
  def sample_ode(self, z_0, conditions, n_steps=100, return_trajectory=False):
      trajectories = [z_0] if return_trajectory else None

      for i in range(n_steps):
          ...
          if return_trajectory:
              trajectories.append(z_t)

      return (z_t, trajectories) if return_trajectory else z_t
```
  ---
  â“ å¸¸è§é—®é¢˜

  Q1: ä¸ºä»€ä¹ˆ Reflow èƒ½ 1 æ­¥ç”Ÿæˆï¼Ÿ

  A: Rectified Flow çš„å…³é”®æ€§è´¨ï¼ˆTheorem 3.7ï¼‰ï¼šé€’å½’åº”ç”¨ reflow ä½¿è·¯å¾„è¶Šæ¥è¶Šç›´ã€‚
  - ç›´çº¿è·¯å¾„å¯ä»¥ç²¾ç¡®åœ°ç”¨ 1 æ­¥ Euler æ–¹æ³•æ±‚è§£
  - è®ºæ–‡å®éªŒï¼š2-rectified flow åœ¨å›¾åƒç”Ÿæˆä¸­ 1 æ­¥å³å¯è¾¾åˆ°å¥½æ•ˆæœ

  Q2: ä¸ DiffMM æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

  | æ¨¡å‹   | æ–¹æ³•                 | é‡‡æ ·æ­¥æ•°   | ç†è®ºåŸºç¡€ |
  |--------|----------------------|------------|----------|
  | DiffMM | Diffusion (SDE)      | 100-1000   | DDPM     |
  | RFMRec | Rectified Flow (ODE) | 1 (reflow) | ç›´çº¿ä¼ è¾“ |

  Q3: æ¡ä»¶ä¿¡å·å¦‚ä½•é€‰æ‹©ï¼Ÿ

  å»ºè®®ä¼˜å…ˆçº§ï¼š
  1. å¿…é€‰ï¼šUser-item äº¤äº’å›¾ï¼ˆååŒè¿‡æ»¤æ ¸å¿ƒï¼‰
  2. æ¨èï¼šè§†è§‰/æ–‡æœ¬ç‰¹å¾ï¼ˆå¦‚æœæœ‰ï¼‰
  3. å¯é€‰ï¼šå…¶ä»–å›¾ç»“æ„ä¿¡æ¯

  ---
  ğŸ“ è®ºæ–‡å¯¹åº”å…³ç³»

  | è®ºæ–‡å†…å®¹             | ä»£ç å®ç°                     |
  |----------------------|------------------------------|
  | å…¬å¼ (1)             | rectified_flow_loss          |
  | Algorithm 1          | sample_ode (Euler æ–¹æ³•)      |
  | Algorithm 4 (Reflow) | è®­ç»ƒå¾ªç¯ä¸­è‡ªåŠ¨æ‰§è¡Œ           |
  | å¤šå°ºåº¦æ¡ä»¶ (Â§5.3)    | MultiScaleVelocityNet + FiLM |

  ---

## ğŸ“š è®ºæ–‡å‚è€ƒ

Liu, X., Gong, C., & Liu, Q. (2022). *Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow*. arXiv preprint arXiv:2209.03003.

## ğŸ¯ æ ¸å¿ƒæ€æƒ³

### é—®é¢˜å®šä¹‰
åœ¨æ¨èç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›ç”Ÿæˆé«˜è´¨é‡çš„ç”¨æˆ·/ç‰©å“åµŒå…¥è¡¨ç¤ºï¼ŒåŒæ—¶åˆ©ç”¨ï¼š
- ğŸ“Š **ååŒä¿¡å·**ï¼šç”¨æˆ·-ç‰©å“äº¤äº’å›¾ç»“æ„
- ğŸ–¼ï¸ **å¤šæ¨¡æ€ç‰¹å¾**ï¼šå›¾åƒç‰¹å¾ã€æ–‡æœ¬ç‰¹å¾
- ğŸ² **ç”Ÿæˆèƒ½åŠ›**ï¼šä»å™ªå£°ç”Ÿæˆå¤šæ ·åŒ–çš„æ½œåœ¨å…´è¶£è¡¨ç¤º

### Rectified Flow è§£å†³æ–¹æ¡ˆ

**ç›®æ ‡**ï¼šå­¦ä¹ ä¸€ä¸ª ODEï¼Œä½¿å…¶æ²¿ç€æœ€ç›´çš„è·¯å¾„ä»å™ªå£°åˆ†å¸ƒä¼ è¾“åˆ°ç›®æ ‡åµŒå…¥åˆ†å¸ƒ

```
dZ_t = v(Z_t, t, conditions) dt
```

å…¶ä¸­ï¼š
- `Z_0 ~ N(0, I)`: éšæœºå™ªå£°ï¼ˆåˆå§‹çŠ¶æ€ï¼‰
- `Z_1`: çœŸå®çš„ç”¨æˆ·/ç‰©å“åµŒå…¥ï¼ˆç›®æ ‡çŠ¶æ€ï¼‰
- `v(Z_t, t, c)`: **é€Ÿåº¦åœºç½‘ç»œ**ï¼ˆæ¡ä»¶åŒ–ç”Ÿæˆï¼‰
- `conditions`: ååŒä¿¡å·ï¼ˆäº¤äº’ã€å¤šæ¨¡æ€ç‰¹å¾ï¼‰

**è®­ç»ƒæŸå¤±**ï¼ˆè®ºæ–‡å…¬å¼1ï¼‰ï¼š

```python
Loss = E_t [ ||v(X_t, t, c) - (X1 - X0)||^2 ]
where X_t = t*X1 + (1-t)*X0
```

## ğŸ”‘ å…³é”®ç‰¹æ€§

### 1ï¸âƒ£ å¤šå°ºåº¦æ¡ä»¶æ³¨å…¥
- âœ… **äº¤äº’ä¿¡å·**ï¼šä»ç”¨æˆ·-ç‰©å“å›¾å·ç§¯æå–ååŒæ¨¡å¼
- âœ… **è§†è§‰ç‰¹å¾**ï¼šç‰©å“å›¾åƒåµŒå…¥
- âœ… **æ–‡æœ¬ç‰¹å¾**ï¼šç‰©å“æ–‡æœ¬åµŒå…¥
- âœ… **FiLM è°ƒåˆ¶**ï¼šåœ¨å¤šä¸ªç½‘ç»œå±‚æ³¨å…¥æ¡ä»¶ï¼ˆè€Œéä»…è¾“å…¥å±‚ï¼‰

### 2ï¸âƒ£ å¿«é€Ÿé‡‡æ ·ï¼ˆReflowï¼‰
- ğŸ“ˆ **1-rectified flow**: åˆå§‹è®­ç»ƒï¼Œ100æ­¥ ODE æ±‚è§£
- ğŸš€ **2-rectified flow**: ç»è¿‡ reflowï¼Œ**ä»…éœ€ 1 æ­¥**å³å¯ç”Ÿæˆé«˜è´¨é‡åµŒå…¥ï¼
- âš¡ **3-rectified flow**: è¿›ä¸€æ­¥æå‡ï¼ˆå¯é€‰ï¼‰

### 3ï¸âƒ£ ç†è®ºä¿è¯
- âœ… ä¿è¯é™ä½ä¼ è¾“ä»£ä»·ï¼ˆTheorem 3.5ï¼‰
- âœ… è·¯å¾„è¶Šæ¥è¶Šç›´ï¼ˆTheorem 3.7ï¼‰
- âœ… é¿å… GAN çš„ä¸ç¨³å®šæ€§

## ğŸ—ï¸ æ¨¡å‹æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RFMRec                              â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Noise     â”‚      â”‚  Collaborative Signals   â”‚    â”‚
â”‚  â”‚   Z_0 ~     â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚   N(0,I)    â”‚      â”‚  â”‚ User-Item Graph    â”‚  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚ Convolution        â”‚  â”‚    â”‚
â”‚         â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚         â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚         â”‚             â”‚  â”‚ Visual Features    â”‚  â”‚    â”‚
â”‚         â”‚             â”‚  â”‚ (Image)            â”‚  â”‚    â”‚
â”‚         â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚         â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚         â”‚             â”‚  â”‚ Text Features      â”‚  â”‚    â”‚
â”‚         â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚         â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                       â”‚                      â”‚
â”‚         â”‚                       â–¼                      â”‚
â”‚         â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ MultiScaleVelocityNet  â”‚        â”‚
â”‚                    â”‚  (Speed Field Network)  â”‚        â”‚
â”‚                    â”‚                         â”‚        â”‚
â”‚                    â”‚  â€¢ Time Embedding       â”‚        â”‚
â”‚                    â”‚  â€¢ Condition Encoders   â”‚        â”‚
â”‚                    â”‚  â€¢ ResNet Blocks        â”‚        â”‚
â”‚                    â”‚  â€¢ FiLM Modulation      â”‚        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                              â”‚                        â”‚
â”‚                              â–¼                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                    â”‚  ODE Solver     â”‚               â”‚
â”‚                    â”‚  (Euler Method) â”‚               â”‚
â”‚                    â”‚  1 step (reflow)â”‚               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                              â”‚                        â”‚
â”‚                              â–¼                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                    â”‚  Z_1            â”‚               â”‚
â”‚                    â”‚  (User & Item   â”‚               â”‚
â”‚                    â”‚   Embeddings)   â”‚               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è®­ç»ƒ 1-Rectified Flow

```bash
cd GenMMRec/src
python main.py --model rfmrec --dataset baby
```

é…ç½®æ–‡ä»¶ï¼š`src/configs/model/RFMREC.yaml`

### 2. Reflowï¼ˆå¯é€‰ï¼Œå¼ºçƒˆæ¨èï¼‰

ç»è¿‡ reflow åï¼Œæ¨¡å‹åªéœ€ **1 æ­¥ ODE æ±‚è§£**å³å¯ç”Ÿæˆé«˜è´¨é‡åµŒå…¥ï¼

```python
# åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
rf_use_reflow: True
rf_reflow_steps: 1  # æˆ– 2
```

Reflow ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨è¿›è¡Œï¼š
1. è®­ç»ƒ 1-rectified flow
2. ä» flow é‡‡æ ·ç”Ÿæˆæ–°æ•°æ® `(Z_0, Z_1)`
3. ç”¨æ–°æ•°æ®é‡æ–°è®­ç»ƒ â†’ å¾—åˆ° 2-rectified flow
4. è·¯å¾„å˜å¾—æ›´ç›´ â†’ 1 æ­¥é‡‡æ ·å³å¯ï¼

### 3. è¯„ä¼°

```bash
# è¯„ä¼°æ¨¡å‹
python main.py --model rfmrec --dataset baby --eval_only
```

## âš™ï¸ é…ç½®å‚æ•°

### æ ¸å¿ƒå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `embedding_size` | 64 | åµŒå…¥ç»´åº¦ |
| `rf_hidden_dim` | 512 | é€Ÿåº¦åœºç½‘ç»œéšè—å±‚ç»´åº¦ |
| `rf_n_layers` | 3 | ResNet å—æ•°é‡ |
| `rf_dropout` | 0.1 | Dropout æ¯”ä¾‹ |
| `rf_sampling_steps` | 100 | ODE æ±‚è§£æ­¥æ•°ï¼ˆè®­ç»ƒæ—¶ï¼‰ |
| `rf_use_reflow` | True | æ˜¯å¦ä½¿ç”¨ reflow |
| `rf_reflow_steps` | 1 | Reflow è¿­ä»£æ¬¡æ•° |

### æŸå¤±æƒé‡

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `lambda_rf` | 1.0 | Rectified Flow æŸå¤±æƒé‡ |
| `lambda_rec` | 0.1 | BPR æ¨èæŸå¤±æƒé‡ |
| `reg_weight` | 0.0001 | L2 æ­£åˆ™åŒ–æƒé‡ |

## ğŸ“Š å®éªŒç»“æœï¼ˆé¢„æœŸï¼‰

åŸºäºè®ºæ–‡ç»“æœï¼Œé¢„æœŸæ€§èƒ½ï¼š

| æ•°æ®é›† | Recall@20 | NDCG@20 | é‡‡æ ·æ­¥æ•° |
|--------|-----------|---------|----------|
| Baby | ~0.06 | ~0.04 | 100 (1-rectified) |
| Baby | ~0.06 | ~0.04 | **1 (2-rectified)** |

**å…³é”®ä¼˜åŠ¿**ï¼š
- âœ… ç”Ÿæˆè´¨é‡ä¸ 100 æ­¥ç›¸å½“
- âœ… æ¨ç†é€Ÿåº¦æå‡ **100 å€**
- âœ… å¤šæ ·åŒ–ç”Ÿæˆï¼ˆä¸åŒå™ªå£° â†’ ä¸åŒå…´è¶£ï¼‰

## ğŸ”¬ é«˜çº§ç”¨æ³•

### 1. è°ƒæ•´ Reflow æ¬¡æ•°

```yaml
# src/configs/model/RFMREC.yaml
rf_reflow_steps: 2  # å°è¯• 2-3 æ¬¡ reflow
```

**ç»éªŒ**ï¼š
- 1 æ¬¡ reflowï¼šæ˜¾è‘—æå‡ï¼Œæ¨èä½¿ç”¨
- 2 æ¬¡ reflowï¼šè¿›ä¸€æ­¥æå‡
- 3+ æ¬¡ï¼šæå‡è¾¹é™…é€’å‡ï¼Œå¯èƒ½ç´¯ç§¯ä¼°è®¡è¯¯å·®

### 2. æ¡ä»¶ä¿¡å·é€‰æ‹©

```python
# åœ¨ get_collaborative_conditions ä¸­è°ƒæ•´
def get_collaborative_conditions(self, users, items):
    conditions = {}

    # 1. å¿…é€‰ï¼šäº¤äº’ä¿¡å·
    conditions['interaction'] = ...

    # 2. å¯é€‰ï¼šè§†è§‰ç‰¹å¾
    if self.has_visual:
        conditions['visual'] = ...

    # 3. å¯é€‰ï¼šæ–‡æœ¬ç‰¹å¾
    if self.has_text:
        conditions['text'] = ...

    return conditions
```

### 3. è’¸é¦ï¼ˆDistillationï¼‰

åœ¨ 2-rectified flow åŸºç¡€ä¸Šï¼Œå¯ä»¥è¿›ä¸€æ­¥è’¸é¦æˆç²¾ç¡®çš„ 1 æ­¥æ¨¡å‹ï¼š

```python
# TODO: å®ç°è’¸é¦é€»è¾‘
# è®­ç»ƒä¸€ä¸ªç›´æ¥æ˜ å°„ Z_0 -> Z_1 çš„ç½‘ç»œ
```

## ğŸ†š ä¸å…¶ä»–æ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | é‡‡æ ·æ­¥æ•° | å¤šæ ·æ€§ | è®­ç»ƒç¨³å®šæ€§ |
|------|----------|--------|------------|
| GAN | 1 | â­â­ | â­â­ |
| VAE | 1 | â­â­â­ | â­â­â­â­ |
| DDPM/DDIM | 100-1000 | â­â­â­â­ | â­â­â­â­â­ |
| **RFMRec** | **1 (reflow)** | â­â­â­â­ | â­â­â­â­â­ |

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æ£€æŸ¥è®­ç»ƒæŸå¤±

```python
# æ­£å¸¸æƒ…å†µï¼š
# rf_loss: 0.5 â†’ 0.1 â†’ 0.05 (é€æ¸ä¸‹é™)
# bpr_loss: 0.3 â†’ 0.2 â†’ 0.15
```

### 2. å¯è§†åŒ–ç”Ÿæˆè·¯å¾„

```python
# åœ¨ sample_ode ä¸­è®°å½•è½¨è¿¹
trajectories = [z_0]
for i in range(n_steps):
    z_t = z_t + v * dt
    trajectories.append(z_t)

# æŸ¥çœ‹è·¯å¾„æ˜¯å¦æ¥è¿‘ç›´çº¿
```

### 3. éªŒè¯æ¡ä»¶ä¿¡å·

```python
# æ‰“å° conditions çš„ç»´åº¦
for name, tensor in conditions.items():
    print(f"{name}: {tensor.shape}")
```

## ğŸ“– ä»£ç ç»“æ„

```
GenMMRec/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ rfmrec.py              # RFMRec ä¸»æ¨¡å‹
â”‚   â”œâ”€â”€ configs/
â”‚   â”‚   â””â”€â”€ model/
â”‚   â”‚       â””â”€â”€ RFMREC.yaml        # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ main.py                     # è®­ç»ƒå…¥å£
â””â”€â”€ RFMREC_README.md                # æœ¬æ–‡æ¡£
```

## ğŸ™ è‡´è°¢

- è®ºæ–‡ï¼šLiu et al., "Flow Straight and Fast", arXiv 2022
- åŸºç¡€æ¡†æ¶ï¼šGenMMRec

## ğŸ“ å¼•ç”¨

å¦‚æœä½¿ç”¨æ­¤ä»£ç ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@article{liu2022flow,
  title={Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow},
  author={Liu, Xingchao and Gong, Chengyue and Liu, Qiang},
  journal={arXiv preprint arXiv:2209.03003},
  year={2022}
}
```

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ issue æˆ–è”ç³»å¼€å‘è€…ã€‚

---

**Happy Flowing! ğŸŒŠ**
